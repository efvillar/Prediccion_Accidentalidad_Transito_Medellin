legend = list(x = 0.75, y = 0.9))
trcntrl = trainControl(method="cv", number=10)
caret_rf_fit_sd = caret::train(ACCIDENTES_LEVES∼Ano_Base+DIA+SEMANA+Feriado_Lunes+Feriado_Otro+Madre+Semana_Santa+Viernes_Desp_Quincena_v2+Feria_Flores, data=Train_D_Dataset,
method = "rf", trControl = trcntrl,
prox=TRUE,allowParallel=TRUE)
summary(caret_rf_fit_sd)
caret_rf_fit_sd
plot(caret_rf_fit_sd)
y_tr_pred_rf_sd<-predict(caret_rf_fit_sd,Train_D_Dataset[,c("Ano_Base","DIA","SEMANA","Feriado_Lunes","Feriado_Otro","Madre","Semana_Santa","Viernes_Desp_Quincena_v2","Feria_Flores")])
mse_tr_rf_sd<-mean((Train_D_Dataset$ACCIDENTES_LEVES-y_tr_pred_rf_sd)^2) # calcula el mse de entrenamiento
RMSE_tr_rf_sd = sqrt(mse_tr_rf_sd)
mse_tr_rf_sd
RMSE_tr_rf_sd
y_test_pred_rf_sd<-predict(caret_rf_fit_sd,Test_D_Dataset[,c("Ano_Base","DIA","SEMANA","Feriado_Lunes","Feriado_Otro","Madre","Semana_Santa","Viernes_Desp_Quincena_v2","Feria_Flores")])
mse_test_rf_sd<-mean((Test_D_Dataset$ACCIDENTES_LEVES-y_test_pred_rf_sd)^2) # calcula el mse de entrenamiento
RMSE_test_rf_sd = sqrt(mse_test_rf_sd)
mse_test_rf_sd
RMSE_test_rf_sd
plot_ly (data=Train_D_Dataset,
x = ~FECHA,
y = ~ACCIDENTES_LEVES,
type = "scatter" ,mode = "lines",
name='Real',
line=list(width=1,color='rgb(205, 12, 24)'))%>%
add_trace(y= ~y_tr_pred_rf_sd,
name='Modelo rf',
line=list(width=1,color='rgb(22, 96, 167)'))%>%
layout(title='Total accidentes leves',
xaxis=list(title="Fecha"),
yaxis=list(title="Accidentes leves"),
legend = list(x = 0.75, y = 0.9))
plot_ly (data=Test_D_Dataset,
x = ~FECHA,
y = ~ACCIDENTES_LEVES,
type = "scatter" ,mode = "lines",
name='Real',
line=list(width=1,color='rgb(205, 12, 24)'))%>%
add_trace(y= ~y_test_pred_rf_sd,
name='Modelo rf',
line=list(width=1,color='rgb(22, 96, 167)'))%>%
layout(title='Total accidentes leves',
xaxis=list(title="Fecha"),
yaxis=list(title="Accidentes leves"),
legend = list(x = 0.75, y = 0.9))
Tipo_de_accidentes= c("Total Accidentes","Total Graves","Total Leves")
RMSE_Train_rf = round(c(RMSE_tr_rf,RMSE_tr_rf_m,RMSE_tr_rf_sd), 3)
RMSE_Test_rf = round(c(RMSE_test_rf,RMSE_test_rf_m,RMSE_test_rf_sd),3)
Tabla_rf = data.frame (cbind(Tipo_de_accidentes,RMSE_Train_rf,RMSE_Test_rf))
Tabla_rf
comparacion_tr<-data.frame(FECHA=Total_Dataset_Freq$FECHA[Total_Dataset_Freq$FECHA<="2017-12-31"],
ACCIDENTES=Total_Dataset_Freq$TOTAL_ACCIDENTES[Total_Dataset_Freq$FECHA<="2017-12-31"],
lm= y_tr_pred_lm,
knn= y_tr_pred_knn,
glm=y_tr_pred_glm ,
arbol=y_tr_pred_tree,
rf=y_tr_pred_rf)
plot_ly (data=comparacion_tr,
x = ~FECHA,
y = ~ACCIDENTES,
type = "scatter" ,mode = "lines",
name='Real',
line=list(width=1,color='rgb(205, 12, 24)'))%>%
add_trace(y= ~lm,
name='lm',
line=list(width=1,color= "blue"))%>%
add_trace(y= ~knn,
name='knn',
line=list(width=1,color="red"))%>%
add_trace(y= ~glm,
name='Modelo Poisson',
line=list(width=1,color='rgb(22, 96, 167)'))%>%
add_trace(y= ~arbol,
name='Árbol',
line=list(width=1,color="green"))%>%
add_trace(y= ~rf,
name='Bosque',
line=list(width=1,color='rgb(255, 51, 153)'))%>%
layout(title='Registros RUNT (Entrenamiento)',
xaxis=list(title="Fecha"),
yaxis=list(title="Unidades"),
legend = list(x = 1, y = 0.9))
comparacion_vl<-data.frame(FECHA=Test_D_Dataset$FECHA,
ACCIDENTES=Test_D_Dataset$TOTAL_ACCIDENTES,
lm= y_test_pred_lm,
knn= y_test_pred_knn,
glm=y_test_pred_glm ,
arbol=y_test_pred_tree,
rf=y_test_pred_rf)
plot_ly (data=comparacion_vl,
x = ~FECHA,
y = ~ACCIDENTES,
type = "scatter" ,mode = "lines",
name='Real',
line=list(width=1,color='rgb(205, 12, 24)'))%>%
add_trace(y= ~lm,
name='lm',
line=list(width=1,color= "blue"))%>%
add_trace(y= ~knn,
name='knn',
line=list(width=1,color="red"))%>%
add_trace(y= ~glm,
name='Modelo Poisson',
line=list(width=1,color='rgb(22, 96, 167)'))%>%
add_trace(y= ~arbol,
name='Árbol',
line=list(width=1,color="green"))%>%
add_trace(y= ~rf,
name='Bosque',
line=list(width=1,color='rgb(255, 51, 153)'))%>%
layout(title='Total Accidentes (Validación)',
xaxis=list(title="Fecha"),
yaxis=list(title="Accidentes"),
legend = list(x = 1, y = 0.9))
Entrenamiento<-round(c(RMSE_tr_lm,RMSE_tr_knn,RMSE_tr_glm,RMSE_tr_tree,RMSE_tr_rf),3)
Validacion<-round(c(RMSE_test_lm,RMSE_test_knn,RMSE_test_glm,RMSE_test_tree,RMSE_test_rf),3)
nombres<-c("lm","knn","glm","árbol","bosque")
ResultadosRMSE<-data.frame(Entrenamiento=Entrenamiento,Validacion=Validacion)
rownames(ResultadosRMSE)<-nombres
ResultadosRMSE$Variacion<-((ResultadosRMSE$Validacion-ResultadosRMSE$Entrenamiento)/ResultadosRMSE$Entrenamiento)*100
ResultadosRMSE
comparacion_tr<-data.frame(FECHA=Total_Dataset_Freq$FECHA[Total_Dataset_Freq$FECHA<="2017-12-31"],
ACCIDENTESG=Total_Dataset_Freq$ACCIDENTES_GRAVES[Total_Dataset_Freq$FECHA<="2017-12-31"],
lm= y_tr_pred_lm_m,
knn= y_tr_pred_knn_m,
glm=y_tr_pred_glm_m,
arbol=y_tr_pred_tree_m,
rf=y_tr_pred_rf_m)
plot_ly (data=comparacion_tr,
x = ~FECHA,
y = ~ACCIDENTESG,
type = "scatter" ,mode = "lines",
name='Real',
line=list(width=1,color='rgb(205, 12, 24)'))%>%
add_trace(y= ~lm,
name='lm-graves',
line=list(width=1,color= "blue"))%>%
add_trace(y= ~knn,
name='knn-graves',
line=list(width=1,color="red"))%>%
add_trace(y= ~glm,
name='Modelo Poisson-graves',
line=list(width=1,color='rgb(22, 96, 167)'))%>%
add_trace(y= ~arbol,
name='Árbo-gravesl',
line=list(width=1,color="green"))%>%
add_trace(y= ~rf,
name='Bosque-graves',
line=list(width=1,color='rgb(255, 51, 153)'))%>%
layout(title='Accidentes graves (Entrenamiento)',
xaxis=list(title="Fecha"),
yaxis=list(title="Accidentes"),
legend = list(x = 1, y = 0.9))
comparacion_vl<-data.frame(FECHA=Test_D_Dataset$FECHA,
ACCIDENTESG=Test_D_Dataset$ACCIDENTES_GRAVES,
lm= y_test_pred_lm_m,
knn= y_test_pred_knn_m,
glm=y_test_pred_glm_m,
arbol=y_test_pred_tree_m,
rf=y_test_pred_rf_m)
plot_ly (data=comparacion_vl,
x = ~FECHA,
y = ~ACCIDENTESG,
type = "scatter" ,mode = "lines",
name='Real',
line=list(width=1,color='rgb(205, 12, 24)'))%>%
add_trace(y= ~lm,
name='lm-graves',
line=list(width=1,color= "blue"))%>%
add_trace(y= ~knn,
name='knn-graves',
line=list(width=1,color="red"))%>%
add_trace(y= ~glm,
name='Modelo Poisson-graves',
line=list(width=1,color='rgb(22, 96, 167)'))%>%
add_trace(y= ~arbol,
name='Árbol-graves',
line=list(width=1,color="green"))%>%
add_trace(y= ~rf,
name='Bosque-graves',
line=list(width=1,color='rgb(255, 51, 153)'))%>%
layout(title='Accidentes graves (Validación)',
xaxis=list(title="Fecha"),
yaxis=list(title="Accidentes"),
legend = list(x = 1, y = 0.9))
Entrenamiento<-round(c(RMSE_tr_lm_m,RMSE_tr_knn_m,RMSE_tr_glm_m,RMSE_tr_tree_m,RMSE_tr_rf_m),3)
Validacion<-round(c(RMSE_test_lm_m,RMSE_test_knn_m,RMSE_test_glm_m,RMSE_test_tree_m,RMSE_test_rf_m),3)
nombres<-c("lm","knn","glm","árbol","bosque")
ResultadosRMSE<-data.frame(Entrenamiento=Entrenamiento,Validacion=Validacion)
rownames(ResultadosRMSE)<-nombres
ResultadosRMSE$Variacion<-((ResultadosRMSE$Validacion-ResultadosRMSE$Entrenamiento)/ResultadosRMSE$Entrenamiento)*100
ResultadosRMSE
comparacion_tr<-data.frame(FECHA=Total_Dataset_Freq$FECHA[Total_Dataset_Freq$FECHA<="2017-12-31"],
ACCIDENTESL=Total_Dataset_Freq$ACCIDENTES_LEVES[Total_Dataset_Freq$FECHA<="2017-12-31"],
lm= y_tr_pred_lm_sd,
knn= y_tr_pred_knn_sd,
glm=y_tr_pred_glm_sd,
arbol=y_tr_pred_tree_sd,
rf=y_tr_pred_rf_sd)
plot_ly (data=comparacion_tr,
x = ~FECHA,
y = ~ACCIDENTESL,
type = "scatter" ,mode = "lines",
name='Real',
line=list(width=1,color='rgb(205, 12, 24)'))%>%
add_trace(y= ~lm,
name='lm-lesves',
line=list(width=1,color= "blue"))%>%
add_trace(y= ~knn,
name='knn-leves',
line=list(width=1,color="red"))%>%
add_trace(y= ~glm,
name='Modelo Poisson-leves',
line=list(width=1,color='rgb(22, 96, 167)'))%>%
add_trace(y= ~arbol,
name='Árbo-leves',
line=list(width=1,color="green"))%>%
add_trace(y= ~rf,
name='Bosque-leves',
line=list(width=1,color='rgb(255, 51, 153)'))%>%
layout(title='Accidentes les (Entrenamiento)',
xaxis=list(title="Fecha"),
yaxis=list(title="Accidentes"),
legend = list(x = 1, y = 0.9))
comparacion_vl<-data.frame(FECHA=Test_D_Dataset$FECHA,
ACCIDENTESL=Test_D_Dataset$ACCIDENTES_GRAVES,
lm= y_test_pred_lm_sd,
knn= y_test_pred_knn_sd,
glm=y_test_pred_glm_sd,
arbol=y_test_pred_tree_sd,
rf=y_test_pred_rf_sd)
plot_ly (data=comparacion_vl,
x = ~FECHA,
y = ~ACCIDENTESL,
type = "scatter" ,mode = "lines",
name='Real',
line=list(width=1,color='rgb(205, 12, 24)'))%>%
add_trace(y= ~lm,
name='lm-leves',
line=list(width=1,color= "blue"))%>%
add_trace(y= ~knn,
name='knn',
line=list(width=1,color="red"))%>%
add_trace(y= ~glm,
name='Modelo Poisson-leves',
line=list(width=1,color='rgb(22, 96, 167)'))%>%
add_trace(y= ~arbol,
name='Árbol-leves',
line=list(width=1,color="green"))%>%
add_trace(y= ~rf,
name='Bosque-leves',
line=list(width=1,color='rgb(255, 51, 153)'))%>%
layout(title='Accidentes lesves (Validación)',
xaxis=list(title="Fecha"),
yaxis=list(title="Accidentes"),
legend = list(x = 1, y = 0.9))
#Porcetaje<-round(C((((RMSE_test_lm_sd-RMSE_tr_lm_sd)/RMSE_tr_lm_sd)*100),(((RMSE_test_lm_sd-RMSE_tr_lm_sd)/RMSE_tr_lm_sd)*100),(((RMSE_test_lm_sd-RMSE_tr_lm_sd)/RMSE_tr_lm_sd)*100),(((RMSE_test_lm_sd-RMSE_tr_lm_sd)/RMSE_tr_lm_sd)*100),(((RMSE_test_lm_sd-RMSE_tr_lm_sd)/RMSE_tr_lm_sd)*100),))
Entrenamiento<-round(c(RMSE_tr_lm_sd,RMSE_tr_knn_sd,RMSE_tr_glm_sd,RMSE_tr_tree_sd,RMSE_tr_rf_sd),3)
Validacion<-round(c(RMSE_test_lm_sd,RMSE_test_knn_sd,RMSE_test_glm_sd,RMSE_test_tree_sd,RMSE_test_rf_sd),3)
nombres<-c("lm","knn","glm","árbol","bosque")
ResultadosRMSE<-data.frame(Entrenamiento=Entrenamiento,Validacion=Validacion)
rownames(ResultadosRMSE)<-nombres
ResultadosRMSE$Variacion<-((ResultadosRMSE$Validacion-ResultadosRMSE$Entrenamiento)/ResultadosRMSE$Entrenamiento)*100
ResultadosRMSE
library(caret)
trcntrl = trainControl(method="cv", number=10)
caret_lm_fit_final = caret::train(TOTAL_ACCIDENTES∼Ano_Base+DIA+SEMANA+Feriado_Lunes+Feriado_Otro+Madre+Semana_Santa+Viernes_Desp_Quincena_v2+Feria_Flores, data=Total_Dataset_Freq,
method = "lm", trControl = trcntrl,
preProcess=c("center", "scale"),
tuneLength = 10)
summary(caret_lm_fit_final)
saveRDS(caret_lm_fit_final,"../Modelos/Prediccion_Total_Diario.rds")
Modelo_Total_diario<-readRDS(file="../Modelos/Prediccion_Total_Diario.rds")
trcntrl = trainControl(method="cv", number=10)
caret_tree_fit_m_final = caret::train(ACCIDENTES_GRAVES∼Ano_Base+DIA+SEMANA+Feriado_Lunes+Feriado_Otro+Madre+Semana_Santa+Viernes_Desp_Quincena_v2+Feria_Flores,data=Total_Dataset_Freq,
method = "rpart", trControl = trcntrl,
parms = list(split = "gini"),
preProcess=c("center", "scale"),
tuneLength = 10)
caret_tree_fit_m_final
saveRDS(caret_tree_fit_m_final,"../Modelos/Prediccion_Grave_Diario.rds")
Modelo_Grave_diario<-readRDS(file="../Modelos/Prediccion_Grave_Diario.rds")
trcntrl = trainControl(method="cv", number=10)
caret_lm_fit_sd_final = caret::train(ACCIDENTES_LEVES∼Ano_Base+DIA+SEMANA+Feriado_Lunes+Feriado_Otro+Madre+Semana_Santa+Viernes_Desp_Quincena_v2+Feria_Flores, data=Total_Dataset_Freq,
method = "lm", trControl = trcntrl,
preProcess=c("center", "scale"),
tuneLength = 10)
summary(caret_lm_fit_sd_final)
saveRDS(caret_lm_fit_sd_final,"../Modelos/Prediccion_leves_Diario.rds")
Modelo_leves_diario<-readRDS(file="../Modelos/Prediccion_leves_Diario.rds")
load("../data/Dias_Especiales_Diario.Rda")
Dias_Especiales$DIA <-as.factor(format(Dias_Especiales$Fecha,'%u'))
head(Dias_Especiales)
datos_pronostico_diario<-Dias_Especiales[,c("Fecha","Ano_Base","DIA","SEMANA","Feriado_Lunes","Feriado_Otro","Madre","Semana_Santa","Viernes_Desp_Quincena_v2","Feria_Flores")]
datos_pronostico_diario$prediccion_Total<-predict(Modelo_Total_diario,datos_pronostico_diario[,c("Ano_Base","DIA","SEMANA","Feriado_Lunes","Feriado_Otro","Madre","Semana_Santa","Viernes_Desp_Quincena_v2","Feria_Flores")])
datos_pronostico_diario$prediccion_Graves<-predict(Modelo_Grave_diario,datos_pronostico_diario[,c("Ano_Base","DIA","SEMANA","Feriado_Lunes","Feriado_Otro","Madre","Semana_Santa","Viernes_Desp_Quincena_v2","Feria_Flores")])
datos_pronostico_diario$prediccion_Leves<-predict(Modelo_leves_diario,datos_pronostico_diario[,c("Ano_Base","DIA","SEMANA","Feriado_Lunes","Feriado_Otro","Madre","Semana_Santa","Viernes_Desp_Quincena_v2","Feria_Flores")])
save(datos_pronostico_diario,file="../Modelos/datos_pronostico_diario.Rda")
load(file = "Dias_Especiales_Mensuales.Rda")
setwd("C:/Users/asus/curso/github/Prediccion_Accidentalidad_Transito_Medellin/Shiny_Final")
load(file = "Dias_Especiales_Mensuales.Rda")
load(file = "Dias_Especiales_Mensuales.Rda")
load(file = "Dias_Especiales_Semanal.Rda")
load(file = "Frecuencia_De_Accidentes_Diario.Rda")
load(file = "Frecuencia_De_Accidentes_Semanal.Rda")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
raw_data_2014 <- read.csv(file="../data/Accidentalidad_georreferenciada_2014.csv", encoding="UTF-8", header=TRUE, sep=",")
raw_data_2015 <- read.csv(file="../data/Accidentalidad_georreferenciada_2015.csv", encoding="UTF-8", header=TRUE, sep=",")
raw_data_2016 <- read.csv(file="../data/Accidentalidad_georreferenciada_2016.csv", encoding="UTF-8", header=TRUE, sep=",")
raw_data_2017 <- read.csv(file="../data/Accidentalidad_georreferenciada_2017.csv", encoding="UTF-8", header=TRUE, sep=",")
raw_data_2018 <- read.csv(file="../data/Accidentalidad_georreferenciada_2018.csv", encoding="UTF-8", header=TRUE, sep=",")
Total_Dataset <- rbind(raw_data_2014,raw_data_2015,raw_data_2016, raw_data_2017, raw_data_2018)
str(Total_Dataset)
summary(Total_Dataset$GRAVEDAD)
levels(Total_Dataset$GRAVEDAD)
levels(Total_Dataset$GRAVEDAD) <- c("ACCIDENTES_GRAVES","ACCIDENTES_GRAVES","ACCIDENTES_LEVES")
levels(Total_Dataset$GRAVEDAD)
rm(raw_data_2014,raw_data_2015,raw_data_2016, raw_data_2017, raw_data_2018)
Total_Dataset$FECHA <- as.Date(Total_Dataset$FECHA, format="%Y-%m-%d")
Total_Dataset <- Total_Dataset[,c('GRAVEDAD','FECHA','DIA','DIA_NOMBRE','MES')]
tail(Total_Dataset)
Total_Dataset$DIA <- as.factor(Total_Dataset$DIA)
Total_Dataset$MES <- as.factor(Total_Dataset$MES)
tail(Total_Dataset)
library(sqldf)
Total_Dataset_Freq <- sqldf("SELECT FECHA, GRAVEDAD, count(GRAVEDAD) AS FREQ, DIA_NOMBRE, MES, DIA
FROM Total_Dataset
GROUP BY FECHA, GRAVEDAD")
Total_Dataset_Freq$Fecha<- NULL
Total_Dataset_Freq$ANO <- as.factor(format(Total_Dataset_Freq$FECHA,'%Y'))
Total_Dataset_Freq$SEMANA <-as.factor(format(Total_Dataset_Freq$FECHA,'%V'))
Total_Dataset_Freq$MES <-as.factor(format(Total_Dataset_Freq$FECHA,'%m'))
head(Total_Dataset_Freq)
levels(Total_Dataset_Freq$DIA_NOMBRE)
levels(Total_Dataset_Freq$DIA_NOMBRE) <- c("DOMINGO","JUEVES","LUNES","MARTES","MIERCOLES","SABADO","VIERNES")
levels(Total_Dataset_Freq$DIA_NOMBRE)
Total_Dataset_Freq$DIA_NOMBRE <- ordered(Total_Dataset_Freq$DIA_NOMBRE,c("LUNES", "MARTES", "MIERCOLES", "JUEVES", "VIERNES", "SABADO", "DOMINGO"))
levels(Total_Dataset_Freq$DIA_NOMBRE)
Dias_Especiales <- read.csv(file="../data/Caracterizacion_v2.csv", encoding="UTF-8", header=TRUE, sep=";",stringsAsFactors=FALSE)
head(Dias_Especiales)
Dias_Especiales <- Dias_Especiales[1:2922,]
Dias_Especiales$Fecha <- as.Date(Dias_Especiales$Fecha, format="%d-%m-%Y")
Total_Dataset_Freq <- sqldf("SELECT *
FROM Total_Dataset_Freq TDF
LEFT JOIN Dias_Especiales DE ON (TDF.FECHA=DE.Fecha)")
Total_Dataset_Freq$Fecha<- NULL
head(Total_Dataset_Freq)
save(Total_Dataset_Freq,file="../data/Frecuencia_De_Accidentes_Diario.Rda")
Dias_Especiales$ANO <- as.factor(format(Dias_Especiales$Fecha,'%Y'))
Dias_Especiales$SEMANA <-as.factor(format(Dias_Especiales$Fecha,'%V'))
Dias_Especiales$MES <-as.factor(format(Dias_Especiales$Fecha,'%m'))
head(Dias_Especiales)
save(Dias_Especiales,file="../data/Dias_Especiales_Diario.Rda")
library(sqldf)
Dias_Especiales_Mensuales <- sqldf("SELECT ANO, MES, sum(Lunes)-4 AS Freq_lunes, sum(martes)-4 AS Freq_martes, sum(miercoles)-4 AS Freq_miercoles, sum(jueves)-4 AS Freq_jueves, sum(viernes)-4 AS Freq_viernes, sum(sabado)-4 AS Freq_sabado, sum(domingo)-4 AS Freq_domingo, sum(Feriado_Lunes+Feriado_Otro) as Feriados, sum(Feriado_Lunes) AS Feriados_Lunes, sum(Feriado_Otro) AS Feriados_Otro
FROM Dias_Especiales
GROUP BY ANO, MES")
save(Dias_Especiales_Mensuales,file="../data/Dias_Especiales_Mensuales.Rda")
library(sqldf)
Total_Dataset_Freq_M <- sqldf("
SELECT TDF.ANO, TDF.MES, TDF.GRAVEDAD, TDF.FREQ, Freq_lunes, Freq_martes, Freq_miercoles, Freq_jueves,Freq_viernes, Freq_sabado, Freq_domingo, Feriados, Feriados_Lunes, Feriados_Otro
FROM
(
SELECT
ANO, MES, GRAVEDAD, sum(FREQ) as FREQ
FROM Total_Dataset_Freq
GROUP BY 1,2,3) TDF
LEFT JOIN Dias_Especiales_Mensuales DEM
ON (TDF.ANO=DEM.ANO AND TDF.MES=DEM.MES)
GROUP BY TDF.ANO, TDF.MES, TDF.GRAVEDAD")
save(Total_Dataset_Freq_M,file="../data/Frecuencia_De_Accidentes_Mensual.Rda")
library(sqldf)
Dias_Especiales_Semanal <- sqldf("SELECT ANO, SEMANA, Feria_Flores_Semana,Semana_Santa_Semana, sum(Feriado_Lunes) as Feriados_Lunes, sum(Feriado_Otro) as Feriados_Otros
FROM Dias_Especiales
GROUP BY ANO,SEMANA,Feria_Flores_Semana,Semana_Santa_Semana")
save(Dias_Especiales_Semanal,file="../data/Dias_Especiales_Semanal.Rda")
library(sqldf)
Total_Dataset_Freq_S <- sqldf("
SELECT TDF.ANO, TDF.SEMANA, TDF.GRAVEDAD, TDF.FREQ, DES.Feria_Flores_Semana AS Feria_Flores, DES.Semana_Santa_Semana AS Semana_Santa, DES.Feriados_Lunes, DES.Feriados_Otros
FROM
(
SELECT
ANO, SEMANA, GRAVEDAD, sum(FREQ) as FREQ
FROM Total_Dataset_Freq
GROUP BY 1,2,3) TDF
LEFT JOIN Dias_Especiales_Semanal DES
ON (TDF.ANO=DES.ANO AND TDF.SEMANA=DES.SEMANA)
GROUP BY TDF.ANO, TDF.SEMANA, TDF.GRAVEDAD")
save(Total_Dataset_Freq_M,file="../data/Frecuencia_De_Accidentes_Semanal.Rda")
View(Dias_Especiales_Semanal)
library(sqldf)
Dias_Especiales_Semanal <- sqldf("SELECT ANO,
CASE WHEN ANO<2016 THEN 0 ELSE 1
END Ano_Base,
SEMANA, Feria_Flores_Semana,Semana_Santa_Semana, sum(Feriado_Lunes) as Feriados_Lunes, sum(Feriado_Otro) as Feriados_Otros
FROM Dias_Especiales
GROUP BY ANO,SEMANA,Feria_Flores_Semana,Semana_Santa_Semana")
View(Dias_Especiales_Semanal)
save(Dias_Especiales_Semanal,file="../data/Dias_Especiales_Semanal.Rda")
library(sqldf)
Total_Dataset_Freq_S <- sqldf("
SELECT TDF.ANO, TDF.Ano_Base, TDF.SEMANA, TDF.GRAVEDAD, TDF.FREQ, DES.Feria_Flores_Semana AS Feria_Flores, DES.Semana_Santa_Semana AS Semana_Santa, DES.Feriados_Lunes, DES.Feriados_Otros
FROM
(
SELECT
ANO, SEMANA, GRAVEDAD, sum(FREQ) as FREQ
FROM Total_Dataset_Freq
GROUP BY 1,2,3) TDF
LEFT JOIN Dias_Especiales_Semanal DES
ON (TDF.ANO=DES.ANO AND TDF.SEMANA=DES.SEMANA)
GROUP BY TDF.ANO, TDF.SEMANA, TDF.GRAVEDAD")
library(sqldf)
Total_Dataset_Freq_S <- sqldf("
SELECT TDF.ANO, DES.Ano_Base, TDF.SEMANA, TDF.GRAVEDAD, TDF.FREQ, DES.Feria_Flores_Semana AS Feria_Flores, DES.Semana_Santa_Semana AS Semana_Santa, DES.Feriados_Lunes, DES.Feriados_Otros
FROM
(
SELECT
ANO, SEMANA, GRAVEDAD, sum(FREQ) as FREQ
FROM Total_Dataset_Freq
GROUP BY 1,2,3) TDF
LEFT JOIN Dias_Especiales_Semanal DES
ON (TDF.ANO=DES.ANO AND TDF.SEMANA=DES.SEMANA)
GROUP BY TDF.ANO, TDF.SEMANA, TDF.GRAVEDAD")
save(Total_Dataset_Freq_M,file="../data/Frecuencia_De_Accidentes_Semanal.Rda")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
raw_data_2014 <- read.csv(file="../data/Accidentalidad_georreferenciada_2014.csv", encoding="UTF-8", header=TRUE, sep=",")
raw_data_2015 <- read.csv(file="../data/Accidentalidad_georreferenciada_2015.csv", encoding="UTF-8", header=TRUE, sep=",")
raw_data_2016 <- read.csv(file="../data/Accidentalidad_georreferenciada_2016.csv", encoding="UTF-8", header=TRUE, sep=",")
raw_data_2017 <- read.csv(file="../data/Accidentalidad_georreferenciada_2017.csv", encoding="UTF-8", header=TRUE, sep=",")
raw_data_2018 <- read.csv(file="../data/Accidentalidad_georreferenciada_2018.csv", encoding="UTF-8", header=TRUE, sep=",")
Total_Dataset <- rbind(raw_data_2014,raw_data_2015,raw_data_2016, raw_data_2017, raw_data_2018)
str(Total_Dataset)
summary(Total_Dataset$GRAVEDAD)
levels(Total_Dataset$GRAVEDAD)
levels(Total_Dataset$GRAVEDAD) <- c("ACCIDENTES_GRAVES","ACCIDENTES_GRAVES","ACCIDENTES_LEVES")
levels(Total_Dataset$GRAVEDAD)
rm(raw_data_2014,raw_data_2015,raw_data_2016, raw_data_2017, raw_data_2018)
Total_Dataset$FECHA <- as.Date(Total_Dataset$FECHA, format="%Y-%m-%d")
Total_Dataset <- Total_Dataset[,c('GRAVEDAD','FECHA','DIA','DIA_NOMBRE','MES')]
tail(Total_Dataset)
Total_Dataset$DIA <- as.factor(Total_Dataset$DIA)
Total_Dataset$MES <- as.factor(Total_Dataset$MES)
tail(Total_Dataset)
library(sqldf)
Total_Dataset_Freq <- sqldf("SELECT FECHA, GRAVEDAD, count(GRAVEDAD) AS FREQ, DIA_NOMBRE, MES, DIA
FROM Total_Dataset
GROUP BY FECHA, GRAVEDAD")
Total_Dataset_Freq$Fecha<- NULL
Total_Dataset_Freq$ANO <- as.factor(format(Total_Dataset_Freq$FECHA,'%Y'))
Total_Dataset_Freq$SEMANA <-as.factor(format(Total_Dataset_Freq$FECHA,'%V'))
Total_Dataset_Freq$MES <-as.factor(format(Total_Dataset_Freq$FECHA,'%m'))
head(Total_Dataset_Freq)
levels(Total_Dataset_Freq$DIA_NOMBRE)
levels(Total_Dataset_Freq$DIA_NOMBRE) <- c("DOMINGO","JUEVES","LUNES","MARTES","MIERCOLES","SABADO","VIERNES")
levels(Total_Dataset_Freq$DIA_NOMBRE)
Total_Dataset_Freq$DIA_NOMBRE <- ordered(Total_Dataset_Freq$DIA_NOMBRE,c("LUNES", "MARTES", "MIERCOLES", "JUEVES", "VIERNES", "SABADO", "DOMINGO"))
levels(Total_Dataset_Freq$DIA_NOMBRE)
Dias_Especiales <- read.csv(file="../data/Caracterizacion_v2.csv", encoding="UTF-8", header=TRUE, sep=";",stringsAsFactors=FALSE)
head(Dias_Especiales)
Dias_Especiales <- Dias_Especiales[1:2922,]
Dias_Especiales$Fecha <- as.Date(Dias_Especiales$Fecha, format="%d-%m-%Y")
Total_Dataset_Freq <- sqldf("SELECT *
FROM Total_Dataset_Freq TDF
LEFT JOIN Dias_Especiales DE ON (TDF.FECHA=DE.Fecha)")
Total_Dataset_Freq$Fecha<- NULL
head(Total_Dataset_Freq)
save(Total_Dataset_Freq,file="../data/Frecuencia_De_Accidentes_Diario.Rda")
Dias_Especiales$ANO <- as.factor(format(Dias_Especiales$Fecha,'%Y'))
Dias_Especiales$SEMANA <-as.factor(format(Dias_Especiales$Fecha,'%V'))
Dias_Especiales$MES <-as.factor(format(Dias_Especiales$Fecha,'%m'))
head(Dias_Especiales)
save(Dias_Especiales,file="../data/Dias_Especiales_Diario.Rda")
library(sqldf)
Dias_Especiales_Mensuales <- sqldf("SELECT ANO, MES, sum(Lunes)-4 AS Freq_lunes, sum(martes)-4 AS Freq_martes, sum(miercoles)-4 AS Freq_miercoles, sum(jueves)-4 AS Freq_jueves, sum(viernes)-4 AS Freq_viernes, sum(sabado)-4 AS Freq_sabado, sum(domingo)-4 AS Freq_domingo, sum(Feriado_Lunes+Feriado_Otro) as Feriados, sum(Feriado_Lunes) AS Feriados_Lunes, sum(Feriado_Otro) AS Feriados_Otro
FROM Dias_Especiales
GROUP BY ANO, MES")
save(Dias_Especiales_Mensuales,file="../data/Dias_Especiales_Mensuales.Rda")
library(sqldf)
Total_Dataset_Freq_M <- sqldf("
SELECT TDF.ANO, TDF.MES, TDF.GRAVEDAD, TDF.FREQ, Freq_lunes, Freq_martes, Freq_miercoles, Freq_jueves,Freq_viernes, Freq_sabado, Freq_domingo, Feriados, Feriados_Lunes, Feriados_Otro
FROM
(
SELECT
ANO, MES, GRAVEDAD, sum(FREQ) as FREQ
FROM Total_Dataset_Freq
GROUP BY 1,2,3) TDF
LEFT JOIN Dias_Especiales_Mensuales DEM
ON (TDF.ANO=DEM.ANO AND TDF.MES=DEM.MES)
GROUP BY TDF.ANO, TDF.MES, TDF.GRAVEDAD")
save(Total_Dataset_Freq_M,file="../data/Frecuencia_De_Accidentes_Mensual.Rda")
library(sqldf)
Dias_Especiales_Semanal <- sqldf("SELECT ANO,
CASE WHEN ANO<2016 THEN 0 ELSE 1
END Ano_Base,
SEMANA, Feria_Flores_Semana,Semana_Santa_Semana, sum(Feriado_Lunes) as Feriados_Lunes, sum(Feriado_Otro) as Feriados_Otros
FROM Dias_Especiales
GROUP BY ANO,SEMANA,Feria_Flores_Semana,Semana_Santa_Semana")
save(Dias_Especiales_Semanal,file="../data/Dias_Especiales_Semanal.Rda")
library(sqldf)
Total_Dataset_Freq_S <- sqldf("
SELECT TDF.ANO, DES.Ano_Base, TDF.SEMANA, TDF.GRAVEDAD, TDF.FREQ, DES.Feria_Flores_Semana AS Feria_Flores, DES.Semana_Santa_Semana AS Semana_Santa, DES.Feriados_Lunes, DES.Feriados_Otros
FROM
(
SELECT
ANO, SEMANA, GRAVEDAD, sum(FREQ) as FREQ
FROM Total_Dataset_Freq
GROUP BY 1,2,3) TDF
LEFT JOIN Dias_Especiales_Semanal DES
ON (TDF.ANO=DES.ANO AND TDF.SEMANA=DES.SEMANA)
GROUP BY TDF.ANO, TDF.SEMANA, TDF.GRAVEDAD")
save(Total_Dataset_Freq_M,file="../data/Frecuencia_De_Accidentes_Semanal.Rda")
